<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Avexo - Waitlist Admin</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    body {
      font-family: 'Poppins', sans-serif;
      background-color: #0b0c10;
      color: #fff;
      padding: 2rem;
    }
    .container {
      max-width: 1200px;
      margin: 0 auto;
    }
    h1 {
      color: #5eead4;
      margin-bottom: 2rem;
    }
    .stats {
      display: flex;
      gap: 2rem;
      margin-bottom: 2rem;
      justify-content: center;
    }
    .auth-container {
      max-width: 500px;
      margin: 10rem auto;
      background: #15171c;
      padding: 3rem;
      border-radius: 12px;
      border: 1px solid #222;
      text-align: center;
    }
    .auth-container h1 {
      color: #5eead4;
      margin-bottom: 1rem;
    }
    .auth-container p {
      color: #ccc;
      margin-bottom: 2rem;
    }
    .auth-form {
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }
    .auth-input {
      padding: 1rem;
      border: 1px solid #222;
      border-radius: 8px;
      background: #0b0c10;
      color: #fff;
      outline: none;
      font-size: 1rem;
    }
    .auth-input:focus {
      border-color: #00ffd0;
    }
    .auth-error {
      color: #ff7e33;
      font-size: 0.9rem;
      display: none;
      margin-top: 0.5rem;
    }
    .auth-success {
      color: #00ffd0;
      font-size: 0.9rem;
      display: none;
      margin-top: 0.5rem;
    }
    .hidden {
      display: none;
    }
    .logout-btn {
      position: absolute;
      top: 2rem;
      right: 2rem;
      background: #15171c;
      color: #ff7e33;
      border: 1px solid #ff7e33;
      padding: 0.6rem 1.2rem;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
    }
    .logout-btn:hover {
      background: #ff7e33;
      color: #000;
    }
    .btn-primary {
      background: #00ffd0;
      color: #000;
    }
    .btn-primary:hover {
      background: #00e6bb;
    }
    .btn-secondary {
      background: #15171c;
      color: #00ffd0;
      border: 1px solid #00ffd0;
    }
    .btn-secondary:hover {
      background: #00ffd0;
      color: #000;
    }
    .table-container {
      background: #15171c;
      border-radius: 12px;
      overflow: hidden;
      border: 1px solid #222;
    }
    table {
      width: 100%;
      border-collapse: collapse;
    }
    thead {
      background: #1a1d24;
    }
    th {
      padding: 1rem;
      text-align: left;
      color: #00ffd0;
      font-weight: 600;
    }
    td {
      padding: 1rem;
      border-top: 1px solid #222;
    }
    tr:hover {
      background: #1a1d24;
    }
    .email-cell {
      color: #5eead4;
    }
    .timestamp-cell {
      color: #ccc;
      font-size: 0.9rem;
    }
    .no-data {
      text-align: center;
      padding: 3rem;
      color: #777;
    }
    .loading {
      text-align: center;
      padding: 3rem;
      color: #00ffd0;
    }
  </style>
</head>
<body>
  <!-- Authentication Screen -->
  <div id="authContainer" class="auth-container">
    <h1>üîê Admin Access</h1>
    <p>Enter your authorized credentials to access the admin dashboard</p>
    <form class="auth-form" onsubmit="verifyCredentials(event)">
      <input 
        type="email" 
        id="authEmail" 
        class="auth-input" 
        placeholder="Email Address" 
        required
      >
      <input 
        type="password" 
        id="authPassword" 
        class="auth-input" 
        placeholder="Password" 
        required
      >
      <button type="submit" class="btn btn-primary">Login</button>
      <div id="authError" class="auth-error"></div>
      <div id="authSuccess" class="auth-success"></div>
    </form>
  </div>

  <!-- Admin Dashboard (hidden by default) -->
  <div id="dashboardContainer" class="container hidden">
    <button class="logout-btn" onclick="logout()">üö™ Logout</button>
    <h1>üìß Waitlist Admin Dashboard</h1>
    
    <div class="stats">
      <div class="stat-card">
        <h2 id="totalCount">0</h2>
        <p>Total Signups</p>
      </div>
      <div class="stat-card">
        <h2 id="todayCount">0</h2>
        <p>Today's Signups</p>
      </div>
    </div>

    <div class="controls">
      <input type="text" id="searchBox" class="search-box" placeholder="Search emails...">
      <div>
        <button class="btn btn-secondary" onclick="refreshData()">üîÑ Refresh</button>
        <button class="btn btn-primary" onclick="exportToCSV()">üì• Export CSV</button>
      </div>
    </div>

    <div class="table-container">
      <table>
        <thead>
          <tr>
            <th>#</th>
            <th>Email Address</th>
            <th>Joined Date</th>
            <th>Time</th>
            <th>IP Address</th>
          </tr>
        </thead>
        <tbody id="emailTable">
          <tr>
            <td colspan="5" class="loading">Loading...</td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

  <script>
    let allEmails = [];
    let isAuthenticated = localStorage.getItem('adminAuth') === 'true';

    // ‚ö†Ô∏è CHANGE THESE TO YOUR ADMIN CREDENTIALS
    const ADMIN_EMAIL = 'admin@gmail.com';
    const ADMIN_PASSWORD = 'admin123';  // Change this to a secure password

    // Check if user is already authenticated
    if (isAuthenticated) {
      showDashboard();
    }

    function verifyCredentials(event) {
      event.preventDefault();
      
      const email = document.getElementById('authEmail').value.trim();
      const password = document.getElementById('authPassword').value;
      const errorDiv = document.getElementById('authError');
      const successDiv = document.getElementById('authSuccess');
      const submitBtn = event.target.querySelector('button[type="submit"]');
      
      // Hide previous messages
      errorDiv.style.display = 'none';
      successDiv.style.display = 'none';
      
      // Disable button
      submitBtn.disabled = true;
      submitBtn.textContent = 'Verifying...';

      // Simulate a slight delay for security
      setTimeout(() => {
        // Check if both email and password match
        if (email.toLowerCase() === ADMIN_EMAIL.toLowerCase() && password === ADMIN_PASSWORD) {
          // Store authentication status
          localStorage.setItem('adminAuth', 'true');
          localStorage.setItem('adminEmail', email);
          isAuthenticated = true;
          
          // Show success message
          successDiv.textContent = 'Access granted! Loading dashboard...';
          successDiv.style.display = 'block';
          
          // Show dashboard after brief delay
          setTimeout(() => {
            showDashboard();
          }, 1000);
        } else {
          // Invalid credentials
          errorDiv.textContent = 'Invalid email or password. Access denied.';
          errorDiv.style.display = 'block';
          submitBtn.disabled = false;
          submitBtn.textContent = 'Login';
          // Clear password field for security
          document.getElementById('authPassword').value = '';
        }
      }, 500);
    }

    function showDashboard() {
      document.getElementById('authContainer').classList.add('hidden');
      document.getElementById('dashboardContainer').classList.remove('hidden');
      loadEmails();
    }

    function logout() {
      if (confirm('Are you sure you want to logout?')) {
        localStorage.removeItem('adminAuth');
        localStorage.removeItem('adminEmail');
        isAuthenticated = false;
        document.getElementById('authContainer').classList.remove('hidden');
        document.getElementById('dashboardContainer').classList.add('hidden');
        document.getElementById('authEmail').value = '';
        document.getElementById('authPassword').value = '';
        document.getElementById('authError').style.display = 'none';
        document.getElementById('authSuccess').style.display = 'none';
      }
    }

    async function loadEmails() {
      try {
        const response = await fetch('/api/admin/waitlist');
        const data = await response.json();
        
        if (data.success) {
          allEmails = data.emails.reverse(); // Show newest first
          updateStats();
          displayEmails(allEmails);
        }
      } catch (error) {
        console.error('Error loading emails:', error);
        document.getElementById('emailTable').innerHTML = '<tr><td colspan="5" class="no-data">Error loading data</td></tr>';
      }
    }

    function updateStats() {
      document.getElementById('totalCount').textContent = allEmails.length;
      
      const today = new Date().toDateString();
      const todayCount = allEmails.filter(entry => {
        return new Date(entry.timestamp).toDateString() === today;
      }).length;
      document.getElementById('todayCount').textContent = todayCount;
    }

    function displayEmails(emails) {
      const tbody = document.getElementById('emailTable');
      
      if (emails.length === 0) {
        tbody.innerHTML = '<tr><td colspan="5" class="no-data">No emails yet</td></tr>';
        return;
      }

      tbody.innerHTML = emails.map((entry, index) => {
        const date = new Date(entry.timestamp);
        return `
          <tr>
            <td>${index + 1}</td>
            <td class="email-cell">${entry.email}</td>
            <td>${date.toLocaleDateString()}</td>
            <td class="timestamp-cell">${date.toLocaleTimeString()}</td>
            <td class="timestamp-cell">${entry.ip || 'N/A'}</td>
          </tr>
        `;
      }).join('');
    }

    function refreshData() {
      document.getElementById('emailTable').innerHTML = '<tr><td colspan="5" class="loading">Loading...</td></tr>';
      loadEmails();
    }

    function exportToCSV() {
      if (allEmails.length === 0) {
        alert('No data to export');
        return;
      }

      const csv = ['Email,Joined Date,Time,IP Address'];
      allEmails.forEach(entry => {
        const date = new Date(entry.timestamp);
        csv.push(`${entry.email},${date.toLocaleDateString()},${date.toLocaleTimeString()},${entry.ip || 'N/A'}`);
      });

      const blob = new Blob([csv.join('\n')], { type: 'text/csv' });
      const url = window.URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `avexo-waitlist-${new Date().toISOString().split('T')[0]}.csv`;
      a.click();
      window.URL.revokeObjectURL(url);
    }

    // Search functionality
    document.getElementById('searchBox').addEventListener('input', (e) => {
      const query = e.target.value.toLowerCase();
      const filtered = allEmails.filter(entry => 
        entry.email.toLowerCase().includes(query)
      );
      displayEmails(filtered);
    });

    // Auto-refresh every 30 seconds (only when authenticated)
    setInterval(() => {
      if (isAuthenticated && !document.getElementById('dashboardContainer').classList.contains('hidden')) {
        loadEmails();
      }
    }, 30000);
  </script>
</body>
</html>
